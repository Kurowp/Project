let maze = [
"::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::",
"::::::::::::::::::::::::::::::::::::---:----------::----------------::::::::::::::::::::::::::::::::",
"::::::::::::::::::::::::::::::---:----=+:=-:=:-=:----=.--:::::-:::-==-:---::::::::::::::::::::::::::",
"::::::::::::::::::::::::::--:-=-:::::-++-=====.=--.=-------:--=----==:.:---:---:::::::::::::::::::::",
"::::::::::::::::::::::----=-:--------==-----:==--=-=------:--=----::-=-:::--::---:::::::::::::::::::",
":::::::::::::::::::--:-===++=:----:-=-:---:==:---=-=:----.=+--=:----:-=+:-:--=--=::-::::::::::::::::",
":::::::::::::::::-:---:=+-:-=--+=-::==--:-:-------==----:+==-:-=-:-====:::-=-=----=-:--:::::::::::::",
"::::::::::::::--::-----:---:---:----:--=--:---:---=+=-------:---==-::--:::-:-==----=+=::-:::::::::::",
"::::::::::::--:--::=::=--:--:=------====-=+-:=-.:-----:-:-=-::-::--==--=-:-::-:--:==::--::-:::::::::",
":::::::::::-::==:-=====-=:-----::-==:--:-==:::---==-:::::-=::==----==::==-::-:--=--:=-:--=:-::::::::",
"::::::::::-:-=-:--:-:::--::--==:----:::----==:=-=---:--------:-==-:=---:-=--:=:-----:----=-:-:::::::",
":::::::::-.--:-=-:-=-----:::--:==:--:=:---::-=-..........-=::-==:-=.--:=-.:::----.==-.==-=-=.-::::::",
"::::::::-:-==-=---==-.=---:.:::..--:--:--:--=-............:---==-:=-.=:==:=-:--==::+==.=:-:::.-:::::",
"::::::::::-=-:-------:=:-=---=--:=:--=:==--==-............=====--:++.====-==-:-.==.---:--=--=:::::::",
"::::::::::=-::-----=-:=-:=====:--==.=+-++=::-===:----------::-==.=*:.::=+-=+--=.=+-===-===-=+-:-::::",
"::::::::::*--:==:-===.==.=+++=::==+-.-:.---:::-=--=::===-:.:----==-:=--==:=+-=::=-=:--:::..:-::-::::",
"::::::::-:*-=:=+=.-:=-:==:--::-=:--::-::---:--=-----:---------:-=+=-::-::==-:-:==:::=-----===.-:::::",
"::::::::--:-=-.:--.---::--=:.--+:=-=-:-==::-==-----.:----::---::-=::-=-==:-:.:==-::--:=:::=+-:-:::::",
"::::::::--::=--.-----==-.:---::+-=---::==:---:..:::.:-::..:---:--:.-=:..--=-----.:--:-+-:-+=:---::::",
"::::::::---:-=:-:--=:.-=-::-==-::-=:::-----:::::::-.::::::--=.:---:::-=-::=-:::===---=-:---:--=-::::",
"::::::::-=::-:-:--:===::=-::.:-:-::-----:::-===----.----=:-==-.:----::----==----::-=-.-==::-:==:::::",
":::::::::=-::-::--.:=+---.:==-::=--=-:.:----=::=--=.:--==-:==--:==--:-:.--+=-==--==::==-:=-:-=-:::::",
":::::::::-=-:::-::===-:--:-::-====::===----::.=====:--:::::=+=--=-:.:---:::--+==-::---:--:--=-::::::",
":::::::::::-=-::-==:.============::=======--::+===+.:::::.::---::-==:::---::==::-==.:-:-::==-:::::::",
"::::::::::::-=-===+:--.:-:--:.-:.=-=+-:..:----+++++.-==--.-::-:..:.=====-::=====-.--:-:-=+-:::::::::",
"::::::::::::::-===+:::---:::--.-==-===========--::-.:--==::::=--:-=::==+===..::--:-:-=-=-:::::::::::",
":::::::::::::-::--+::-::----:::.:===-::--::-=====-:::--===--:=--:-===:--::---:-:::-:=+-:::::::::::::",
":::::::::::::::::::-==-----:::--:--:..:-----======---:-+++--:==--:..:-=-----::=---=-:::--:::::::::::",
"::::::::::::::::::::::---==-::::=======================================:::::::===-:::-::::::::::::::",
"::::::::::::::::::::::::-:--=-:::::::::::::::::::::::::::::::::::::::::::-==---:::::::::::::::::::::",
"================:::::::::-::::--========================================:::::::-:===================",
"=================================:::---=-=-----=---=-----=--=--=---::===============================",
"====================================================================================================",
"===================================================================================================="

];

let scene;

window.addEventListener("DOMContentLoaded",function() {
  scene = document.querySelector("a-scene");
  console.log(scene)
  for(let r = 0; r < maze.length; r++){
    let row = maze[r];
    let cols = row.split("");
    for(let c = 0; c < cols.length; c++){
      const baseX = 5*c - 260;
      const baseZ = 15*r - 270;
      const yz = -2 + Math.floor(Math.random() * 6);

      if(cols[c] == "+" || cols[c] == "." ){
        new Wall2(baseX, yz, baseZ);
      }
      if(cols[c] == ":" ){
        new Wall(baseX, yz, baseZ);
      }
    }
  }

})

// cleaning helper: remove isolated small rocks inside paths
// replaces isolated '+' or '.' with '=' when they appear surrounded by path chars
function cleanMazeArray(mazeArr){
  const rockChars = new Set(['+.'.replace(/./g, '')]);
  const pathChars = new Set(['-','=']);
  const rows = mazeArr.map(r => r.split(''));
  const H = rows.length;
  const W = rows[0].length;
  const out = rows.map(r => r.slice());

  for(let y=0;y<H;y++){
    for(let x=0;x<W;x++){
      const ch = rows[y][x];
      if(!rockChars.has(ch)) continue;

      // count same-type neighbors and path-like neighbors
      let same = 0;
      let pathCount = 0;
      const neigh = [[1,0],[-1,0],[0,1],[0,-1]];
      for(const [dx,dy] of neigh){
        const nx = x + dx, ny = y + dy;
        if(nx < 0 || nx >= W || ny < 0 || ny >= H) continue;
        const n = rows[ny][nx];
        if(rockChars.has(n)) same++;
        if(pathChars.has(n)) pathCount++;
      }

      // if the rock is isolated (no adjacent rock) and sits among path chars, convert it
      if(same === 0 && pathCount >= 2){
        out[y][x] = '=';
      }
    }
  }

  return out.map(r => r.join(''));
}

// apply cleaning once at load so maze used below is cleaner
maze = cleanMazeArray(maze);
